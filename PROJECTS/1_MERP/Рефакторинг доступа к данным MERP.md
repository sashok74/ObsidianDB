# üõ†Ô∏è –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º MERP: —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

## 1. –¶–µ–ª—å
- –û—Ç–≤—è–∑–∞—Ç—å –±–∏–∑–Ω–µ—Å-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫—É –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ë–î, JSON, —Ç–µ—Å—Ç–æ–≤—ã–µ –º–æ–∫–∏).
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `OutParam`, `MyData`) –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å–ø–æ—Å–æ–±–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.
- **–õ–æ–≥–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è** (fill) —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (Loader-—ã).
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ILoader`.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å–≤–æ–π Loader (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ë–î ‚Äî `RecordsetLoader`, –¥–ª—è JSON ‚Äî `JsonLoader`).

---

## 3. –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 3.1. –í—ã–Ω–µ—Å–∏—Ç–µ –ª–æ–≥–∏–∫—É –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä
- –£–¥–∞–ª–∏—Ç–µ –º–µ—Ç–æ–¥—ã —Ç–∏–ø–∞ `FromRecordset` –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä.
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω:
  ```cpp
  template<typename Source>
  static void FromSource(Source& src, MyData& m) {
      src.fill("id", m.id);
      src.fill("name", m.name);
      // ...
  }
  ```

### 3.2. –í–Ω–µ–¥—Ä–∏—Ç–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é Loader
- –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
  ```cpp
  class ILoader {
  public:
      virtual ~ILoader() = default;
      virtual bool Next() = 0;
      virtual void FillCurrent(void* item) = 0;
  };
  ```

### 3.3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ Loader-—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –î–ª—è –ë–î: `RecordsetLoader<T>` (–≤–Ω—É—Ç—Ä–∏ —Ö—Ä–∞–Ω–∏—Ç CMRecordset)
- –î–ª—è JSON: `JsonLoader<T>` (–≤–Ω—É—Ç—Ä–∏ —Ö—Ä–∞–Ω–∏—Ç json-–º–∞—Å—Å–∏–≤)
- –î–ª—è –º–æ–∫–æ–≤: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

### 3.4. –†–µ—Ñ–∞–∫—Ç–æ—Ä ContainerWrapper
- –¢–µ–ø–µ—Ä—å –æ–Ω –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:
  ```cpp
  template<typename Container>
  class ContainerWrapper {
      Container& container;
      std::unique_ptr<ILoader> loader;
  public:
      ContainerWrapper(Container& cont, std::unique_ptr<ILoader> ldr)
          : container(cont), loader(std::move(ldr)) {}
      void LoadAll() {
          using ItemType = typename Container::value_type;
          while (loader->Next()) {
              ItemType item;
              loader->FillCurrent(&item);
              container.push_back(item);
          }
      }
  };
  ```

### 3.5. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ù–∞–ø—Ä–∏–º–µ—Ä, `MSDatabase` –∏–ª–∏ `JSONDatabase`, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç Loader –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

### 3.6. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```cpp
// –î–ª—è –ë–î
CMRecordset rec(...);
auto loader = std::make_unique<RecordsetLoader<MyData>>(std::move(rec));
std::vector<MyData> results;
MSDatabase db;
db.Load(results, std::move(loader));

// –î–ª—è JSON
nlohmann::json j = ...;
auto loader = std::make_unique<JsonLoader<MyData>>(j);
db.Load(results, std::move(loader));
```

---

## 4. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞
- **–ì–∏–±–∫–æ—Å—Ç—å:** –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∫–∏ –∏ json –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î.
- **–ò–∑–æ–ª—è—Ü–∏—è:** –±–∏–∑–Ω–µ—Å-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –î–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤—Å–µ–≥–¥–∞ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π `FromSource`.
- –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `JSONDatabase` –∏–ª–∏ –º–æ–∫–∏.
- –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ë–î –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `RecordsetLoader`.

---

## 6. –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```
src/
  ILoader.h
  RecordsetLoader.h
  JsonLoader.h
  IDatabase.h
  MSDatabase.h
  JSONDatabase.h
  example_usage.cpp
  example_json_db.cpp
```

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ MERP.  
–°–º. –ø—Ä–∏–º–µ—Ä—ã –≤ `C:/Monarch/MERP_UNIT_TEST/src/`.  
–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –≤ –∫–æ–º–∞–Ω–¥—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.**
