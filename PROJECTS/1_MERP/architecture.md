# Архитектура доступа к данным в MERP

## Общие принципы

Архитектура доступа к данным в проекте MERP основана на многослойном подходе с чётким разделением ответственности. Ниже описаны основные компоненты системы и их взаимодействие.

## Генерируемые компоненты

Следующие файлы создаются генератором и играют ключевую роль в системе доступа к данным:

### 1. [[SQLQueries|Перечисление SQL-запросов]] (`SQLQueries.h`)
- Содержит `enum class Querys` со всеми возможными запросами к базе данных
- Каждый запрос имеет уникальный идентификатор в перечислении
- Используется во всей системе для типобезопасного обращения к запросам
- **Пример**: `Querys::file_list_s`, `Querys::catalogs_i`

### 2. Определение структур данных (`[Модуль]SQL.h`)
- Для каждого модуля (например, `FileListSQL.h`) определяются:
  - Структуры входных параметров (`InParam<Querys::запрос>`)
  - Структуры выходных параметров (`OutParam<Querys::запрос>`)
  - Вспомогательные функции для работы с данными
- Используется для типизированной передачи параметров в запросы и получения результатов
- **Пример**: `FileListSQL.h` содержит структуры для работы с файловыми списками

### 3. [[IDataProvider|Интерфейсы провайдеров данных]] (`I[Модуль]DataProvider.h`)
- Определяют контракт для доступа к данным конкретного модуля
- Содержат виртуальные методы для операций CRUD:
  - Методы с суффиксом `S` для выборки (Select)
  - Методы с суффиксом `I` для вставки (Insert)
  - Методы с суффиксом `U` для обновления (Update)
  - Методы с суффиксом `D` для удаления (Delete)
- **Пример**: `IFileListDataProvider.h` определяет интерфейс для работы со списками файлов

### 4. Реализации провайдеров данных (`[Модуль]SQLDataProvider.h/cpp`)
- Реализуют соответствующие интерфейсы
- Содержат конкретную логику работы с базой данных
- Используют низкоуровневые механизмы доступа к БД
- **Пример**: `FileListSQLDataProvider.cpp` содержит реализацию интерфейса `IFileListDataProvider`

## Вспомогательные классы

### 1. [[DataSet|Классы для работы с наборами данных]]
- **`DataSet`** (`DataSet.h`) - универсальный контейнер для работы с наборами данных:
  - Управление состоянием (просмотр, редактирование)
  - Навигация по записям
  - Фильтрация и сортировка
  - Сигналы изменений

### 2. Классы для связи с визуальными контролами
- **[[GridDataSource]]** (`GridDataSource.h`) - источник данных для табличных представлений:
  - Связывание данных с таблицами
  - Обработка событий таблицы
  - Отображение и редактирование данных
  
- **[[TreeDataSource]]** (`TreeDataSource.h`) - источник данных для древовидных представлений:
  - Иерархическое представление данных
  - Развертывание/свертывание узлов
  - Обработка событий дерева

### 3. [[MSDatabase|Основной класс доступа к данным]]
- **`MSDatabase`** (`MSDatabase.h`) - центральный класс для доступа к базе данных:
  - Предоставляет единую точку доступа к базе данных
  - Управляет соединениями
  - Координирует транзакции

## См. также
- [[format-merp|Правила форматирования]]
- [[DataSet|Подробнее о DataSet]]