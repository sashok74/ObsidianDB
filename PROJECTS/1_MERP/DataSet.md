# DataSet в MERP

## Основное назначение
`DataSet` является универсальным контейнером для работы с наборами данных, который служит промежуточным слоем между [[IDataProvider|источниками данных]] и UI-компонентами.

## Ключевые возможности

### 1. Управление состоянием
- **Режимы работы**:
  - Режим просмотра (View Mode)
  - Режим редактирования (Edit Mode)
- **Отслеживание изменений**:
  - Флаги модификации записей
  - История изменений

### 2. Навигация по данным
- Курсор для текущей записи
- Методы перемещения:
  - Следующая/предыдущая запись
  - Первая/последняя запись
  - Переход к записи по индексу

### 3. Управление данными
- Фильтрация записей
- Сортировка данных
- Группировка (если поддерживается)

## Связи с другими компонентами

### 1. [[IDataProvider|Источники данных]]
- Получает данные через провайдеры:
  ```cpp
  class IDataProvider {
      virtual void Select() = 0;
      virtual void Insert() = 0;
      virtual void Update() = 0;
      virtual void Delete() = 0;
  };
  ```

### 2. UI-компоненты
- **[[GridDataSource]]**:
  - Связывание с табличными представлениями
  - Автоматическое обновление UI при изменении данных
  - Обработка пользовательского ввода

- **[[TreeDataSource]]**:
  - Иерархическое представление данных
  - Управление узлами дерева
  - События развертывания/свертывания

### 3. [[ProcessLogic|Бизнес-логика]]
- Интеграция с процессами обработки данных
- Валидация бизнес-правил
- Транзакционность операций

## Сигналы и события

1. **Сигналы изменения данных**:
   - `OnDataChanged` - при изменении данных
   - `OnRecordChanged` - при изменении текущей записи
   - `OnStateChanged` - при изменении состояния

2. **Сигналы навигации**:
   - `OnBeforeMove` - перед перемещением курсора
   - `OnAfterMove` - после перемещения курсора

3. **Сигналы редактирования**:
   - `OnBeginEdit` - начало редактирования
   - `OnEndEdit` - завершение редактирования
   - `OnCancelEdit` - отмена редактирования

## Пример использования

```cpp
// Создание DataSet
auto dataSet = std::make_shared<DataSet>();

// Привязка к источнику данных
dataSet->SetDataProvider(dataProvider);

// Привязка к UI
auto gridSource = std::make_shared<GridDataSource>(dataSet);
gridView->SetDataSource(gridSource);

// Работа с данными
dataSet->BeginEdit();
dataSet->SetFieldValue("name", "New Value");
dataSet->EndEdit();
```

## Интеграция с [[MSDatabase|базой данных]]

1. **Загрузка данных**:
   ```cpp
   void LoadData() {
       auto query = SQLQueries::data_select;
       dataSet->Load(query);
   }
   ```

2. **Сохранение изменений**:
   ```cpp
   void SaveChanges() {
       dataSet->ApplyChanges();
   }
   ```

## Рекомендации по использованию

1. **Производительность**:
   - Используйте постраничную загрузку для больших наборов данных
   - Применяйте фильтрацию на уровне SQL
   - Оптимизируйте запросы для минимизации объема данных

2. **Безопасность**:
   - Проверяйте права доступа перед операциями
   - Валидируйте входные данные
   - Используйте параметризованные запросы

3. **Надежность**:
   - Обрабатывайте исключения
   - Используйте транзакции
   - Реализуйте механизм отката изменений

## См. также
- [[SQLQueries]] - Перечисление SQL-запросов
- [[IDataProvider]] - Интерфейс провайдера данных
- [[GridDataSource]] - Источник данных для таблиц
- [[TreeDataSource]] - Источник данных для деревьев
- [[MSDatabase]] - Основной класс доступа к БД
- [[ProcessLogic]] - Бизнес-логика обработки данных
- [[architecture|Архитектура MERP]]